generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Lead {
  id        String   @id @default(cuid())
  name      String
  phone     String
  email     String
  status    String
  source    String   @default("contact_form")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  notes     String?
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  password       String
  name           String
  role           Role            @default(STUDENT)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  announcements  Announcement[]
  attendance     Attendance[]
  queries        Query[]
  studentProfile StudentProfile?
  submissions    Submission[]
  teacherProfile TeacherProfile?
}

model StudentProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  phone          String?
  enrollmentDate DateTime @default(now())
  batchId        String?
  tier           String?  @default("hands-on")
  batch          Batch?   @relation(fields: [batchId], references: [id])
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TeacherProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  specialization String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courses        Course[] @relation("CourseToTeacherProfile")
}

model Batch {
  id        String           @id @default(cuid())
  name      String
  startDate DateTime
  endDate   DateTime?
  courseId  String
  course    Course           @relation(fields: [courseId], references: [id])
  students  StudentProfile[]
}

model Course {
  id               String           @id @default(cuid())
  title            String
  description      String?
  slug             String           @unique
  price            Decimal          @default(0.0)
  level            String           @default("Beginner")
  thumbnailUrl     String?
  published        Boolean          @default(false)
  metaTitle        String?
  metaDescription  String?
  keywords         String?
  whatYouWillLearn String?
  features         String?
  assignments      Assignment[]
  batches          Batch[]
  modules          Module[]
  teachers         TeacherProfile[] @relation("CourseToTeacherProfile")
}

model Module {
  id       String   @id @default(cuid())
  title    String
  order    Int
  courseId String
  lessons  Lesson[]
  course   Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

model Lesson {
  id       String  @id @default(cuid())
  title    String
  content  String?
  moduleId String
  module   Module  @relation(fields: [moduleId], references: [id], onDelete: Cascade)
}

model Assignment {
  id          String       @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime?
  courseId    String
  course      Course       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  submissions Submission[]
}

model Submission {
  id           String     @id @default(cuid())
  fileUrl      String
  submittedAt  DateTime   @default(now())
  grade        Int?
  feedback     String?
  studentId    String
  assignmentId String
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  student      User       @relation(fields: [studentId], references: [id])
}

model Attendance {
  id       String           @id @default(cuid())
  date     DateTime
  status   AttendanceStatus
  userId   String
  markedBy String?
  user     User             @relation(fields: [userId], references: [id])
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  content   String
  createdAt DateTime @default(now())
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
}

model Query {
  id        String   @id @default(cuid())
  subject   String
  message   String
  status    String   @default("OPEN")
  createdAt DateTime @default(now())
  studentId String
  student   User     @relation(fields: [studentId], references: [id])
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}
